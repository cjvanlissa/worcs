<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Using Endpoints to Check Reproducibility • worcs</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<script src="../extra.js"></script><meta property="og:title" content="Using Endpoints to Check Reproducibility">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">worcs</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.20</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/citation.html">Citing references in worcs</a></li>
    <li><a class="dropdown-item" href="../articles/endpoints.html">Using Endpoints to Check Reproducibility</a></li>
    <li><a class="dropdown-item" href="../articles/git_cloud.html">Connecting to 'Git' remote repositories</a></li>
    <li><a class="dropdown-item" href="../articles/reproduce.html">Reproducing a WORCS project</a></li>
    <li><a class="dropdown-item" href="../articles/setup-docker.html">Setting up your computer for WORCS - Docker-edition</a></li>
    <li><a class="dropdown-item" href="../articles/setup.html">Setting up your computer for WORCS</a></li>
    <li><a class="dropdown-item" href="../articles/synthetic_data.html">Using Custom Synthetic Data</a></li>
    <li><a class="dropdown-item" href="../articles/targets.html">Using targets to Reduce Redundant Computations</a></li>
    <li><a class="dropdown-item" href="../articles/workflow.html">The WORCS workflow, version 0.1.16</a></li>
    <li><a class="dropdown-item" href="../articles/zenodo.html">Archiving a WORCS Project on 'Zenodo'</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/cjvanlissa/worcs/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Using Endpoints to Check Reproducibility</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/cjvanlissa/worcs/blob/master/vignettes/endpoints.Rmd" class="external-link"><code>vignettes/endpoints.Rmd</code></a></small>
      <div class="d-none name"><code>endpoints.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/cjvanlissa/worcs" class="external-link">worcs</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Welcome to WORCS: Workflow for Open Reproducible Code in Science. Run</span></span>
<span><span class="co">#&gt; `check_worcs_installation()` to make sure all dependencies are installed. For</span></span>
<span><span class="co">#&gt; more information, see the package vignettes</span></span>
<span><span class="co">#&gt; (<span style="color: #0000BB; font-style: italic;">&lt;https://cjvanlissa.github.io/worcs/articles&gt;</span>) and accompanying</span></span>
<span><span class="co">#&gt; paper: Van Lissa and colleagues (2020)</span></span>
<span><span class="co">#&gt; (<span style="color: #0000BB; font-style: italic;">&lt;https://doi.org/10.3233/DS-210031&gt;</span>)</span></span></code></pre></div>
<p>This vignette describe the <code>worcs</code> package’s functionality
for automating reproducibility. The basic idea is that the entry point,
endpoint (or endpoints), and recipe by which to get to the endpoint from
the entry point are all well-defined.</p>
<p>In a typical <code>worcs</code> project, the entry point will be a
dynamic document (e.g., <code>manuscript.Rmd</code>), and the endpoint
will be the rendered manuscript (e.g., <code>manuscript.pdf</code>). The
recipe by which to get from the entry point to the endpoint is often a
simple call to <code>rmarkdown::render("manuscript.Rmd")</code>.</p>
<p>By default, the entry point and recipe are documented in the
<code>.worcs</code> project file when the project is created, if an
R-script or Rmarkdown file is selected as the manuscript. Endpoints are
not created by default, as it only makes sense to define them when the
analyses are complete.</p>
<p>Custom recipes can be added to a project using
<code><a href="../reference/add_recipe.html">add_recipe()</a></code>.</p>
<div class="section level2">
<h2 id="adding-endpoints">Adding endpoints<a class="anchor" aria-label="anchor" href="#adding-endpoints"></a>
</h2>
<p>Users can add endpoints using the function
<code>add_endpoint("filename")</code>. When running this function,
<code>filename</code> is added to the <code>.worcs</code> project file,
and its checksum is computed so that any changes to the contents of the
file can be detected. Note that checksums change in response to
<em>any</em> change to a file, no matter how trivial it may seem to us.
Thus, if there is any randomness in your analysis (ranging from Monte
Carlo estimation, bootstrapping, or even just jittering dots in a plot),
or any rounding error down to the 15th decimal, the checksum will
change. Be mindful of this, and only add endpoints that you are quite
sure will not vary due to randomness.</p>
<p>It is possible to specify multiple endpoints. For example, maybe the
user has finalized the analyses, and wants to track reproducibility for
the analysis results - but still wants to make changes to the text of
the manuscript without breaking reproducibility checks. In this case, it
is useful to track files that contain analysis results instead of the
rendered manuscript. Imagine these are intermediary files with analysis
results:</p>
<ul>
<li>
<code>descriptives.csv</code>: A file with the descriptive
statistics of study variables</li>
<li>
<code>model_fit.csv</code>: A table with model fit indices for
several models</li>
<li>
<code>finalmodel.RData</code>: An RData file with the results of the
final model</li>
</ul>
<p>These three files could be tracked as endpoints by calling
<code>add_endpoint("descriptives.csv"); add_endpoint("model_fit.csv"); add_endpoint("finalmodel.RData")</code>.</p>
</div>
<div class="section level2">
<h2 id="integration-tests-as-endpoints">Integration Tests as Endpoints<a class="anchor" aria-label="anchor" href="#integration-tests-as-endpoints"></a>
</h2>
<p>The R-package <code>testthat</code> allows users to specify
“integration tests” - checks that verify that a given operation yields
the expected result. Integration tests are commonplace in software
development, but they are evidently also useful in research.</p>
<p>For example, if you write your own function to conduct an analysis,
you may want to test it on some synthetic data to make sure that it
behaves as expected.</p>
<p>Integration tests are also useful to check reproducibility: while
checksums change in response to any trivial change to a file, tests can
explicitly allow for rounding error.</p>
<p>For example, imagine that you conduct the following analysis:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run analysis</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">Sepal.Length</span> <span class="op">~</span> <span class="va">Sepal.Width</span> <span class="op">+</span> <span class="va">Petal.Length</span>, <span class="va">iris</span><span class="op">)</span></span>
<span><span class="co"># Extract regression coefficients</span></span>
<span><span class="va">tab_coef</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span><span class="op">$</span><span class="va">coefficients</span></span>
<span><span class="co"># Write to file</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">tab_coef</span>, <span class="st">"tab_coef.csv"</span><span class="op">)</span></span>
<span><span class="co"># Get checksum for file</span></span>
<span><span class="fu">digest</span><span class="fu">::</span><span class="fu"><a href="https://eddelbuettel.github.io/digest/man/digest.html" class="external-link">digest</a></span><span class="op">(</span><span class="st">"tab_coef.csv"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "124f039ae361721bb8a6d137f50a7b73"</span></span></code></pre></div>
<p>Now, if we just round these results to the 15th decimal, the checksum
will be different:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Write to file</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">tab_coef</span>, digits <span class="op">=</span> <span class="fl">15</span><span class="op">)</span>, <span class="st">"tab_coef2.csv"</span><span class="op">)</span></span>
<span><span class="co"># Get checksum for file</span></span>
<span><span class="fu">digest</span><span class="fu">::</span><span class="fu"><a href="https://eddelbuettel.github.io/digest/man/digest.html" class="external-link">digest</a></span><span class="op">(</span><span class="st">"tab_coef2.csv"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "02989acb201b1208f822a0e05a9be96a"</span></span></code></pre></div>
<p>This is not a trivial example: different computer hardware rounds
numbers differently in the high decimals. Therefore, using
<code>tab_coef.csv</code> as an endpoint could result in failure to
reproduce, even if it is essentially the same.</p>
<p>An integration test, by contrast, can allow for rounding error, and
would allow the same comparison to pass. Here, I use a three-decimal
tolerance:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">testthat</span><span class="fu">::</span><span class="fu"><a href="https://testthat.r-lib.org/reference/equality-expectations.html" class="external-link">expect_equal</a></span><span class="op">(</span><span class="va">tab_coef</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">tab_coef</span>, digits <span class="op">=</span> <span class="fl">15</span><span class="op">)</span>, tolerance <span class="op">=</span> <span class="fl">1e-3</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="adding-integration-tests">Adding Integration Tests<a class="anchor" aria-label="anchor" href="#adding-integration-tests"></a>
</h3>
<p>To set up a test suite for your project, run:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">worcs</span><span class="fu">::</span><span class="fu"><a href="../reference/add_testthat.html">add_testthat</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Next, you will have to write each of the tests you want to conduct to
its own file. Call this functions to set up your first test file:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">usethis</span><span class="fu">::</span><span class="fu"><a href="https://usethis.r-lib.org/reference/use_r.html" class="external-link">use_test</a></span><span class="op">(</span><span class="st">"my_first_test.R"</span><span class="op">)</span></span></code></pre></div>
<p>By default, the tests are not added as endpoints - but you can run
them interactively with the function <code><a href="../reference/add_testthat.html">worcs::test_worcs()</a></code>.
If you want to add them as endpoints, simply pass the argument
<code>"testthat"</code> to the endpoints function:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">worcs</span><span class="fu">::</span><span class="fu"><a href="../reference/add_endpoint.html">add_endpoint</a></span><span class="op">(</span><span class="st">"testthat"</span><span class="op">)</span></span></code></pre></div>
<p>After doing so, reproducing the project (see next section) will also
run the integration test suite.</p>
</div>
</div>
<div class="section level2">
<h2 id="reproducing-a-project">Reproducing a Project<a class="anchor" aria-label="anchor" href="#reproducing-a-project"></a>
</h2>
<p>A WORCS project can be reproduced by evaluating the function
<code><a href="../reference/reproduce.html">reproduce()</a></code>. This function evaluates the recipe defined in
the <code>.worcs</code> project file. If no recipe is specified (e.g.,
when a project was created with an older version of the package), but an
entry point is defined, <code><a href="../reference/reproduce.html">reproduce()</a></code> will try to evaluate
the entry point if it is an Rmarkdown or R source file.</p>
</div>
<div class="section level2">
<h2 id="checking-reproducibility">Checking reproducibility<a class="anchor" aria-label="anchor" href="#checking-reproducibility"></a>
</h2>
<p>Users can verify that the endpoint remains unchanged after
reproducing the project by calling the function
<code><a href="../reference/check_endpoints.html">check_endpoints()</a></code>. If any endpoint has changed relative to
the version stored in the <code>.worcs</code> project file, this will
result in a warning message.</p>
</div>
<div class="section level2">
<h2 id="updating-endpoints">Updating endpoints<a class="anchor" aria-label="anchor" href="#updating-endpoints"></a>
</h2>
<p>To update the endpoints in the <code>.worcs</code> file, call
<code><a href="../reference/snapshot_endpoints.html">snapshot_endpoints()</a></code>. Always call this function to log
changes to the code that should result in a different end result.</p>
</div>
<div class="section level2">
<h2 id="automating-reproducibility">Automating Reproducibility<a class="anchor" aria-label="anchor" href="#automating-reproducibility"></a>
</h2>
<p>If a project is connected to a remote repository on GitHub, it is
possible to use GitHub actions to automatically check a project’s
reproducibility and signal the result of this reproducibility check by
displaying a badge on the project’s readme page (which is the welcome
page visitors of the GitHub repository first see).</p>
<p>To do so, follow these steps:</p>
<ol style="list-style-type: decimal">
<li>Add endpoint using add_endpoint(); for example, if the endpoint of
your analyses is a file called <code>'manuscript/manuscript.md'</code>,
then you would call
<code>add_endpoint('manuscript/manuscript.md')</code>
</li>
<li>Run <code><a href="../reference/github_action_check_endpoints.html">github_action_reproduce()</a></code>
</li>
<li>You should see a message asking you to copy-paste code for a status
badge to your <code>readme.md</code>. If you do not see this message,
add the following code to your readme.md manually:
<ul>
<li><code>[![worcs_endpoints](https://github.com/YOUR_ACCOUNT/PROJECT_REPOSITORY/actions/workflows/worcs_reproduce.yaml/badge.svg)](https://github.com/YOUR_ACCOUNT/PROJECT_REPOSITORY/actions/worcs_reproduce.yaml/worcs_endpoints.yaml)</code></li>
</ul>
</li>
<li>Commit these changes to GitHub using <code><a href="../reference/git_update.html">git_update()</a></code>
</li>
</ol>
<p>Visit your project page on GitHub and select the <code>Actions</code>
tab to see that your reproducibility check is running; visit the main
project page to see the new badge in your readme.md file.</p>
</div>
<div class="section level2">
<h2 id="automating-endpoint-checks">Automating Endpoint Checks<a class="anchor" aria-label="anchor" href="#automating-endpoint-checks"></a>
</h2>
<p>Sometimes, you may wish to verify that the endpoints of a project
remain the same but without reproducing all analyses on GitHub’s
servers. This may be the case when the project has closed data that are
not available on GitHub, or if the analyses take a long time to compute
and you want to prevent using unnecessary compute power (e.g., for
environmental reasons).</p>
<p>In these cases, you can still use GitHub actions to automatically
check whether the endpoints have remained unchanged. If your local
changes to the project introduce deviations from the endpoint snapshots,
these tests will fail.</p>
<p>If you make intentional changes to the endpoints, you should of
course run <code><a href="../reference/snapshot_endpoints.html">snapshot_endpoints()</a></code>.</p>
<p>You can display a badge on the project’s readme page to signal that
the endpoints remain unchanged.</p>
<p>To do so, follow these steps:</p>
<ol style="list-style-type: decimal">
<li>Add endpoint using add_endpoint(); for example, if the endpoint of
your analyses is a file called <code>'manuscript/manuscript.md'</code>,
then you would call
<code>add_endpoint('manuscript/manuscript.md')</code>
</li>
<li>Run <code><a href="../reference/github_action_check_endpoints.html">github_action_check_endpoints()</a></code>
</li>
<li>You should see a message asking you to copy-paste code for a status
badge to your <code>readme.md</code>. If you do not see this message,
add the following code to your readme.md manually:
<ul>
<li><code>[![worcs_endpoints](https://github.com/YOUR_ACCOUNT/PROJECT_REPOSITORY/actions/workflows/worcs_endpoints.yaml/badge.svg)](https://github.com/YOUR_ACCOUNT/PROJECT_REPOSITORY/actions/workflows/worcs_endpoints.yaml)</code></li>
</ul>
</li>
<li>Commit these changes to GitHub using <code><a href="../reference/git_update.html">git_update()</a></code>
</li>
</ol>
<p>Visit your project page on GitHub and select the <code>Actions</code>
tab to see that your reproducibility check is running; visit the main
project page to see the new badge in your readme.md file.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Caspar J. Van Lissa, Aaron Peikert, Andreas M. Brandmaier.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
