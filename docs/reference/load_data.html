<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Load WORCS project data — load_data • worcs</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Load WORCS project data — load_data"><meta property="og:description" content='Scans the WORCS project file for data that have been saved using
open_data or closed_data, and loads these data
into the global (working) environment. The function will load the original
data if available on the current system. If only a synthetic dataset is
available, this function loads the synthetic data.
The name of the object containing the data is derived from the file name by
removing the file extension, and, when applicable, the prefix
"synthetic_". Thus, both "data.csv" and
"synthetic_data.csv" will be loaded into an object called data.'><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">worcs</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.9.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/citation.html">Citing references in worcs</a>
    </li>
    <li>
      <a href="../articles/git_cloud.html">Connecting to 'Git' remote repositories</a>
    </li>
    <li>
      <a href="../articles/reproduce.html">Reproducing a WORCS project</a>
    </li>
    <li>
      <a href="../articles/setup-docker.html">Setting up your computer for WORCS - Docker-edition</a>
    </li>
    <li>
      <a href="../articles/setup.html">Setting up your computer for WORCS</a>
    </li>
    <li>
      <a href="../articles/workflow.html">The WORCS workflow, version 0.1.6</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/cjvanlissa/worcs/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Load WORCS project data</h1>
    <small class="dont-index">Source: <a href="https://github.com/cjvanlissa/worcs/blob/HEAD/R/save_load.R" class="external-link"><code>R/save_load.R</code></a></small>
    <div class="hidden name"><code>load_data.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Scans the WORCS project file for data that have been saved using
<code><a href="open_data.html">open_data</a></code> or <code><a href="closed_data.html">closed_data</a></code>, and loads these data
into the global (working) environment. The function will load the original
data if available on the current system. If only a synthetic dataset is
available, this function loads the synthetic data.
The name of the object containing the data is derived from the file name by
removing the file extension, and, when applicable, the prefix
<code>"synthetic_"</code>. Thus, both <code>"data.csv"</code> and
<code>"synthetic_data.csv"</code> will be loaded into an object called <code>data</code>.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">load_data</span><span class="op">(</span>
  worcs_directory <span class="op">=</span> <span class="st">"."</span>,
  to_envir <span class="op">=</span> <span class="cn">TRUE</span>,
  envir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sys.parent.html" class="external-link">parent.frame</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>,
  verbose <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>worcs_directory</dt>
<dd><p>Character, indicating the WORCS project directory from
which to load data. The default value <code>"."</code> points to the current
directory.</p></dd>
<dt>to_envir</dt>
<dd><p>Logical, indicating whether to load objects directly into
the environment, or return a <code><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></code> containing the objects. The
environment is designated by argument <code>envir</code>. Loading
objects directly into the global environment is user-friendly, but has the
risk of overwriting an existing object with the same name, as explained in
<code><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></code>. The function <code>load_data</code> gives a warning when this
happens.</p></dd>
<dt>envir</dt>
<dd><p>The environment where the data should be loaded. The default
value <code>parent.frame(1)</code> refers to the global environment in an
interactive session.</p></dd>
<dt>verbose</dt>
<dd><p>Logical. Whether or not to print status messages to
the console. Default: TRUE</p></dd>
</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>Returns a list invisibly. If <code>to_envir = TRUE</code>, this list
contains the loaded data files. If <code>to_envir = FALSE</code>, the list is
empty, and the loaded data files are attached directly to the global
environment.</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="va">test_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"loaddata"</span><span class="op">)</span></span>
<span class="r-in"><span class="va">old_wd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd</a></span><span class="op">(</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">test_dir</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">setwd</a></span><span class="op">(</span><span class="va">test_dir</span><span class="op">)</span></span>
<span class="r-in"><span class="fu">worcs</span><span class="fu">:::</span><span class="fu">write_worcsfile</span><span class="op">(</span><span class="st">".worcs"</span><span class="op">)</span></span>
<span class="r-in"><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">iris</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="op">]</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span><span class="fu"><a href="closed_data.html">closed_data</a></span><span class="op">(</span><span class="va">df</span>, codebook <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">v  </span><span style="color: #000000;">Storing original data in 'df.csv' and updating the checksum in '.worcs'.</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">v  </span><span style="color: #000000;">Creating C:/Users/lissa102/AppData/Local/Temp/RtmpczRWfk/loaddata/README.md.</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">v  </span><span style="color: #000000;">Generating synthetic data for public use. Ensure that no identifying information is included.</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   |                                                                              |                                                                      |   0%  |                                                                              |==============                                                        |  20%  |                                                                              |============================                                          |  40%  |                                                                              |==========================================                            |  60%  |                                                                              |========================================================              |  80%  |                                                                              |======================================================================| 100%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">v  </span><span style="color: #000000;">Storing synthetic data in 'synthetic_df.csv' and updating the checksum in '.worcs'.</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">v  </span><span style="color: #000000;">Updating '.gitignore'.</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">v  </span><span style="color: #000000;">Updating C:/Users/lissa102/AppData/Local/Temp/RtmpczRWfk/loaddata/README.md.</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">v  </span><span style="color: #000000;">Updating '.gitignore'.</span></span>
<span class="r-in"><span class="fu">load_data</span><span class="op">(</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">v  </span><span style="color: #000000;">Loading original data from 'df.csv'.</span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Object 'df' already exists in the environment designated by 'envir', and will be replaced with the contents of 'df.csv'.</span>
<span class="r-in"><span class="va">data</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (..., list = character(), package = NULL, lib.loc = NULL, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     verbose = getOption("verbose"), envir = .GlobalEnv, overwrite = TRUE) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     fileExt &lt;- function(x) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         db &lt;- grepl("\\.[^.]+\\.(gz|bz2|xz)$", x)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         ans &lt;- sub(".*\\.", "", x)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         ans[db] &lt;- sub(".*\\.([^.]+\\.)(gz|bz2|xz)$", "\\1\\2", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             x[db])</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         ans</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     my_read_table &lt;- function(...) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         lcc &lt;- Sys.getlocale("LC_COLLATE")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         on.exit(Sys.setlocale("LC_COLLATE", lcc))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         Sys.setlocale("LC_COLLATE", "C")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         read.table(...)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     names &lt;- c(as.character(substitute(list(...))[-1L]), list)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is.null(package)) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         if (!is.character(package)) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             stop("'package' must be a character string or NULL")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         if (FALSE) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             if (any(package %in% "base")) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 warning("datasets have been moved from package 'base' to package 'datasets'")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             if (any(package %in% "stats")) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 warning("datasets have been moved from package 'stats' to package 'datasets'")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             package[package %in% c("base", "stats")] &lt;- "datasets"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     paths &lt;- find.package(package, lib.loc, verbose = verbose)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (is.null(lib.loc)) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         paths &lt;- c(path.package(package, TRUE), if (!length(package)) getwd(), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             paths)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     paths &lt;- unique(normalizePath(paths[file.exists(paths)]))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     paths &lt;- paths[dir.exists(file.path(paths, "data"))]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     dataExts &lt;- tools:::.make_file_exts("data")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (length(names) == 0L) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         db &lt;- matrix(character(), nrow = 0L, ncol = 4L)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         for (path in paths) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             entries &lt;- NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             packageName &lt;- if (file_test("-f", file.path(path, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 "DESCRIPTION"))) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 basename(path)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             else "."</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             if (file_test("-f", INDEX &lt;- file.path(path, "Meta", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 "data.rds"))) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 entries &lt;- readRDS(INDEX)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             else {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 dataDir &lt;- file.path(path, "data")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 entries &lt;- tools::list_files_with_type(dataDir, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   "data")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 if (length(entries)) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   entries &lt;- unique(tools::file_path_sans_ext(basename(entries)))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   entries &lt;- cbind(entries, "")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             if (NROW(entries)) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 if (is.matrix(entries) &amp;&amp; ncol(entries) == 2L) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   db &lt;- rbind(db, cbind(packageName, dirname(path), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                     entries))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 else warning(gettextf("data index for package %s is invalid and will be ignored", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   sQuote(packageName)), domain = NA, call. = FALSE)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         colnames(db) &lt;- c("Package", "LibPath", "Item", "Title")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         footer &lt;- if (missing(package)) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             paste0("Use ", sQuote(paste("data(package =", ".packages(all.available = TRUE))")), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 "\n", "to list the data sets in all *available* packages.")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         else NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         y &lt;- list(title = "Data sets", header = NULL, results = db, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             footer = footer)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         class(y) &lt;- "packageIQR"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(y)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     paths &lt;- file.path(paths, "data")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     for (name in names) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         found &lt;- FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         for (p in paths) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             tmp_env &lt;- if (overwrite) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 envir</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             else new.env()</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             if (file_test("-f", file.path(p, "Rdata.rds"))) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 rds &lt;- readRDS(file.path(p, "Rdata.rds"))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 if (name %in% names(rds)) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   found &lt;- TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   if (verbose) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                     message(sprintf("name=%s:\t found in Rdata.rds", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                       name), domain = NA)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   thispkg &lt;- sub(".*/([^/]*)/data$", "\\1", p)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   thispkg &lt;- sub("_.*$", "", thispkg)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   thispkg &lt;- paste0("package:", thispkg)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   objs &lt;- rds[[name]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   lazyLoad(file.path(p, "Rdata"), envir = tmp_env, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                     filter = function(x) x %in% objs)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   break</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 else if (verbose) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   message(sprintf("name=%s:\t NOT found in names() of Rdata.rds, i.e.,\n\t%s\n", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                     name, paste(names(rds), collapse = ",")), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                     domain = NA)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             if (file_test("-f", file.path(p, "Rdata.zip"))) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 warning("zipped data found for package ", sQuote(basename(dirname(p))), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   ".\nThat is defunct, so please re-install the package.", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   domain = NA)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 if (file_test("-f", fp &lt;- file.path(p, "filelist"))) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   files &lt;- file.path(p, scan(fp, what = "", quiet = TRUE))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 else {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   warning(gettextf("file 'filelist' is missing for directory %s", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                     sQuote(p)), domain = NA)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   next</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             else {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 files &lt;- list.files(p, full.names = TRUE)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             files &lt;- files[grep(name, files, fixed = TRUE)]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             if (length(files) &gt; 1L) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 o &lt;- match(fileExt(files), dataExts, nomatch = 100L)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 paths0 &lt;- dirname(files)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 paths0 &lt;- factor(paths0, levels = unique(paths0))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 files &lt;- files[order(paths0, o)]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             if (length(files)) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 for (file in files) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   if (verbose) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                     message("name=", name, ":\t file= ...", .Platform$file.sep, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                       basename(file), "::\t", appendLF = FALSE, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                       domain = NA)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   ext &lt;- fileExt(file)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   if (basename(file) != paste0(name, ".", ext)) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                     found &lt;- FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   else {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                     found &lt;- TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                     zfile &lt;- file</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                     zipname &lt;- file.path(dirname(file), "Rdata.zip")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                     if (file.exists(zipname)) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                       Rdatadir &lt;- tempfile("Rdata")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                       dir.create(Rdatadir, showWarnings = FALSE)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                       topic &lt;- basename(file)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                       rc &lt;- .External(C_unzip, zipname, topic, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                         Rdatadir, FALSE, TRUE, FALSE, FALSE)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                       if (rc == 0L) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                         zfile &lt;- file.path(Rdatadir, topic)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                     if (zfile != file) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                       on.exit(unlink(zfile))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                     switch(ext, R = , r = {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                       library("utils")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                       sys.source(zfile, chdir = TRUE, envir = tmp_env)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                     }, RData = , rdata = , rda = load(zfile, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                       envir = tmp_env), TXT = , txt = , tab = , </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                       tab.gz = , tab.bz2 = , tab.xz = , txt.gz = , </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                       txt.bz2 = , txt.xz = assign(name, my_read_table(zfile, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                         header = TRUE, as.is = FALSE), envir = tmp_env), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                       CSV = , csv = , csv.gz = , csv.bz2 = , </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                       csv.xz = assign(name, my_read_table(zfile, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                         header = TRUE, sep = ";", as.is = FALSE), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                         envir = tmp_env), found &lt;- FALSE)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   if (found) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                     break</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 if (verbose) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   message(if (!found) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                     "*NOT* ", "found", domain = NA)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             if (found) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 break</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         if (!found) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             warning(gettextf("data set %s not found", sQuote(name)), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 domain = NA)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         else if (!overwrite) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             for (o in ls(envir = tmp_env, all.names = TRUE)) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 if (exists(o, envir = envir, inherits = FALSE)) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   warning(gettextf("an object named %s already exists and will not be overwritten", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                     sQuote(o)))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 else assign(o, get(o, envir = tmp_env, inherits = FALSE), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   envir = envir)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             rm(tmp_env)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     invisible(names)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x00000000459f6fd0&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: namespace:utils&gt;</span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="st">"data"</span><span class="op">)</span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>object 'data' not found</span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.remove</a></span><span class="op">(</span><span class="st">"data.csv"</span><span class="op">)</span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>cannot remove file 'data.csv', reason 'No such file or directory'</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] FALSE</span>
<span class="r-in"><span class="fu">load_data</span><span class="op">(</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">v  </span><span style="color: #000000;">Loading original data from 'df.csv'.</span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Object 'df' already exists in the environment designated by 'envir', and will be replaced with the contents of 'df.csv'.</span>
<span class="r-in"><span class="va">data</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (..., list = character(), package = NULL, lib.loc = NULL, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     verbose = getOption("verbose"), envir = .GlobalEnv, overwrite = TRUE) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     fileExt &lt;- function(x) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         db &lt;- grepl("\\.[^.]+\\.(gz|bz2|xz)$", x)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         ans &lt;- sub(".*\\.", "", x)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         ans[db] &lt;- sub(".*\\.([^.]+\\.)(gz|bz2|xz)$", "\\1\\2", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             x[db])</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         ans</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     my_read_table &lt;- function(...) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         lcc &lt;- Sys.getlocale("LC_COLLATE")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         on.exit(Sys.setlocale("LC_COLLATE", lcc))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         Sys.setlocale("LC_COLLATE", "C")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         read.table(...)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     names &lt;- c(as.character(substitute(list(...))[-1L]), list)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (!is.null(package)) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         if (!is.character(package)) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             stop("'package' must be a character string or NULL")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         if (FALSE) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             if (any(package %in% "base")) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 warning("datasets have been moved from package 'base' to package 'datasets'")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             if (any(package %in% "stats")) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 warning("datasets have been moved from package 'stats' to package 'datasets'")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             package[package %in% c("base", "stats")] &lt;- "datasets"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     paths &lt;- find.package(package, lib.loc, verbose = verbose)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (is.null(lib.loc)) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         paths &lt;- c(path.package(package, TRUE), if (!length(package)) getwd(), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             paths)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     paths &lt;- unique(normalizePath(paths[file.exists(paths)]))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     paths &lt;- paths[dir.exists(file.path(paths, "data"))]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     dataExts &lt;- tools:::.make_file_exts("data")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     if (length(names) == 0L) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         db &lt;- matrix(character(), nrow = 0L, ncol = 4L)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         for (path in paths) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             entries &lt;- NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             packageName &lt;- if (file_test("-f", file.path(path, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 "DESCRIPTION"))) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 basename(path)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             else "."</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             if (file_test("-f", INDEX &lt;- file.path(path, "Meta", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 "data.rds"))) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 entries &lt;- readRDS(INDEX)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             else {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 dataDir &lt;- file.path(path, "data")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 entries &lt;- tools::list_files_with_type(dataDir, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   "data")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 if (length(entries)) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   entries &lt;- unique(tools::file_path_sans_ext(basename(entries)))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   entries &lt;- cbind(entries, "")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             if (NROW(entries)) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 if (is.matrix(entries) &amp;&amp; ncol(entries) == 2L) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   db &lt;- rbind(db, cbind(packageName, dirname(path), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                     entries))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 else warning(gettextf("data index for package %s is invalid and will be ignored", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   sQuote(packageName)), domain = NA, call. = FALSE)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         colnames(db) &lt;- c("Package", "LibPath", "Item", "Title")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         footer &lt;- if (missing(package)) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             paste0("Use ", sQuote(paste("data(package =", ".packages(all.available = TRUE))")), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 "\n", "to list the data sets in all *available* packages.")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         else NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         y &lt;- list(title = "Data sets", header = NULL, results = db, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             footer = footer)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         class(y) &lt;- "packageIQR"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         return(y)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     paths &lt;- file.path(paths, "data")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     for (name in names) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         found &lt;- FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         for (p in paths) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             tmp_env &lt;- if (overwrite) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 envir</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             else new.env()</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             if (file_test("-f", file.path(p, "Rdata.rds"))) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 rds &lt;- readRDS(file.path(p, "Rdata.rds"))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 if (name %in% names(rds)) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   found &lt;- TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   if (verbose) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                     message(sprintf("name=%s:\t found in Rdata.rds", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                       name), domain = NA)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   thispkg &lt;- sub(".*/([^/]*)/data$", "\\1", p)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   thispkg &lt;- sub("_.*$", "", thispkg)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   thispkg &lt;- paste0("package:", thispkg)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   objs &lt;- rds[[name]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   lazyLoad(file.path(p, "Rdata"), envir = tmp_env, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                     filter = function(x) x %in% objs)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   break</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 else if (verbose) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   message(sprintf("name=%s:\t NOT found in names() of Rdata.rds, i.e.,\n\t%s\n", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                     name, paste(names(rds), collapse = ",")), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                     domain = NA)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             if (file_test("-f", file.path(p, "Rdata.zip"))) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 warning("zipped data found for package ", sQuote(basename(dirname(p))), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   ".\nThat is defunct, so please re-install the package.", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   domain = NA)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 if (file_test("-f", fp &lt;- file.path(p, "filelist"))) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   files &lt;- file.path(p, scan(fp, what = "", quiet = TRUE))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 else {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   warning(gettextf("file 'filelist' is missing for directory %s", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                     sQuote(p)), domain = NA)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   next</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             else {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 files &lt;- list.files(p, full.names = TRUE)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             files &lt;- files[grep(name, files, fixed = TRUE)]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             if (length(files) &gt; 1L) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 o &lt;- match(fileExt(files), dataExts, nomatch = 100L)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 paths0 &lt;- dirname(files)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 paths0 &lt;- factor(paths0, levels = unique(paths0))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 files &lt;- files[order(paths0, o)]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             if (length(files)) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 for (file in files) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   if (verbose) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                     message("name=", name, ":\t file= ...", .Platform$file.sep, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                       basename(file), "::\t", appendLF = FALSE, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                       domain = NA)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   ext &lt;- fileExt(file)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   if (basename(file) != paste0(name, ".", ext)) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                     found &lt;- FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   else {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                     found &lt;- TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                     zfile &lt;- file</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                     zipname &lt;- file.path(dirname(file), "Rdata.zip")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                     if (file.exists(zipname)) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                       Rdatadir &lt;- tempfile("Rdata")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                       dir.create(Rdatadir, showWarnings = FALSE)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                       topic &lt;- basename(file)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                       rc &lt;- .External(C_unzip, zipname, topic, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                         Rdatadir, FALSE, TRUE, FALSE, FALSE)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                       if (rc == 0L) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                         zfile &lt;- file.path(Rdatadir, topic)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                     if (zfile != file) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                       on.exit(unlink(zfile))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                     switch(ext, R = , r = {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                       library("utils")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                       sys.source(zfile, chdir = TRUE, envir = tmp_env)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                     }, RData = , rdata = , rda = load(zfile, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                       envir = tmp_env), TXT = , txt = , tab = , </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                       tab.gz = , tab.bz2 = , tab.xz = , txt.gz = , </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                       txt.bz2 = , txt.xz = assign(name, my_read_table(zfile, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                         header = TRUE, as.is = FALSE), envir = tmp_env), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                       CSV = , csv = , csv.gz = , csv.bz2 = , </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                       csv.xz = assign(name, my_read_table(zfile, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                         header = TRUE, sep = ";", as.is = FALSE), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                         envir = tmp_env), found &lt;- FALSE)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   if (found) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                     break</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 if (verbose) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   message(if (!found) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                     "*NOT* ", "found", domain = NA)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             if (found) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 break</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         if (!found) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             warning(gettextf("data set %s not found", sQuote(name)), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 domain = NA)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         else if (!overwrite) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             for (o in ls(envir = tmp_env, all.names = TRUE)) {</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 if (exists(o, envir = envir, inherits = FALSE)) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   warning(gettextf("an object named %s already exists and will not be overwritten", </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                     sQuote(o)))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 else assign(o, get(o, envir = tmp_env, inherits = FALSE), </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   envir = envir)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             rm(tmp_env)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     invisible(names)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x00000000459f6fd0&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: namespace:utils&gt;</span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">setwd</a></span><span class="op">(</span><span class="va">old_wd</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/unlink.html" class="external-link">unlink</a></span><span class="op">(</span><span class="va">test_dir</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Caspar J. van Lissa, Aaron Peikert, Andreas M. Brandmaier.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
</div>

      </footer></div>

  


  

  </body></html>

